<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Keyholder - Visible Fix</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; 
            overflow: hidden; 
            background: #000;
        }
        
        #ar-scene { 
            width: 100vw; 
            height: 100vh; 
        }
        
        #status-overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }
        
        .status-item {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .status-ok { color: #4ade80; }
        .status-error { color: #f87171; }
        .status-warning { color: #fbbf24; }
        
        #instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .marker-link {
            color: #60a5fa;
            text-decoration: none;
            margin-top: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
    <div id="status-overlay">
        <h3>ğŸ¯ AR Keyholder</h3>
        <div class="status-item" id="camera-status">ğŸ“· ã‚«ãƒ¡ãƒ©: <span class="status-ok">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span></div>
        <div class="status-item" id="ar-status">ğŸ” AR: <span class="status-ok">æº–å‚™å®Œäº†</span></div>
        <div class="status-item" id="marker-status">ğŸ“ ãƒãƒ¼ã‚«ãƒ¼: æ¤œå‡ºå¾…æ©Ÿä¸­</div>
        <div class="status-item" id="visibility-status">ğŸ‘ï¸ è¡¨ç¤º: <span class="status-warning">å¾…æ©Ÿä¸­</span></div>
    </div>
    
    <!-- ä½¿ç”¨æ–¹æ³• -->
    <div id="instructions">
        <strong>ğŸ“– ä½¿ç”¨æ–¹æ³•:</strong><br>
        1. <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" 
              target="_blank" class="marker-link">Hiroãƒãƒ¼ã‚«ãƒ¼</a>ã‚’è¡¨ç¤º<br>
        2. ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„<br>
        3. å¤§ããª3Dã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼
    </div>

    <!-- AR.js Scene - è¦–èªæ€§æœ€å„ªå…ˆ -->
    <a-scene
        id="ar-scene"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; antialias: true; alpha: true;"
        embedded
        arjs="
            trackingMethod: best; 
            sourceType: webcam; 
            debugUIEnabled: false; 
            detectionMode: mono_and_matrix; 
            matrixCodeType: 3x3;
            sourceWidth: 640;
            sourceHeight: 480;
            displayWidth: 640;
            displayHeight: 480;
            maxDetectionRate: 60;
            canvasWidth: 640;
            canvasHeight: 480;
        "
        loading-screen="enabled: false">
        
        <!-- Hiroãƒãƒ¼ã‚«ãƒ¼ -->
        <a-marker 
            preset="hiro" 
            id="hiro-marker"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2">
            
            <!-- 3Dã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ - å¤§ããã€é«˜ãé…ç½® -->
            <a-entity id="keyholder-object" position="0 0 0" scale="2 2 2">
                
                <!-- åŸºæº–ç‚¹ï¼ˆç·‘ã®çƒï¼‰ -->
                <a-sphere
                    position="0 0.1 0"
                    radius="0.05"
                    color="#00ff00"
                    material="emissive: #00ff00; emissiveIntensity: 1.0;">
                </a-sphere>
                
                <!-- ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ãƒœãƒ‡ã‚£ - é«˜ã„ä½ç½®ã«é…ç½® -->
                <a-box
                    position="0 1.0 0"
                    width="0.8"
                    height="1.0"
                    depth="0.3"
                    color="#ff6b6b"
                    material="color: #ff6b6b; roughness: 0.3; metalness: 0.5; emissive: #ff2222; emissiveIntensity: 0.2;"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
                    
                    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®é¡” - ã‚ˆã‚Šå¤§ãã -->
                    <a-sphere
                        position="0 0.3 0.2"
                        radius="0.2"
                        color="#ffeb3b"
                        material="color: #ffeb3b; roughness: 0.8; metalness: 0.1; emissive: #ffff00; emissiveIntensity: 0.3;">
                        
                        <!-- ç›® - ã‚ˆã‚Šå¤§ãã -->
                        <a-sphere position="-0.06 0.05 0.15" radius="0.03" color="#000"></a-sphere>
                        <a-sphere position="0.06 0.05 0.15" radius="0.03" color="#000"></a-sphere>
                        
                        <!-- ç¬‘é¡” -->
                        <a-torus 
                            position="0 -0.05 0.15" 
                            radius="0.06" 
                            radius-tubular="0.01" 
                            rotation="0 0 0"
                            color="#000"
                            theta-start="0"
                            theta-length="180">
                        </a-torus>
                    </a-sphere>
                    
                    <!-- è…• -->
                    <a-sphere position="-0.5 0 0" radius="0.1" color="#ffeb3b"></a-sphere>
                    <a-sphere position="0.5 0 0" radius="0.1" color="#ffeb3b"></a-sphere>
                </a-box>
                
                <!-- ã‚­ãƒ¼ãƒªãƒ³ã‚° - éå¸¸ã«é«˜ã„ä½ç½® -->
                <a-torus
                    position="0 2.0 0"
                    color="#c0c0c0"
                    radius="0.4"
                    radius-tubular="0.05"
                    material="color: #c0c0c0; metalness: 1.0; roughness: 0.1; emissive: #888888; emissiveIntensity: 0.4;"
                    animation="property: rotation; to: 360 0 0; loop: true; dur: 6000">
                </a-torus>
                
                <!-- æ¥ç¶šãƒã‚§ãƒ¼ãƒ³ - ç›®ç«‹ã¤ã‚ˆã†ã« */
                <a-entity id="chain">
                    <a-cylinder position="0 1.8 0" radius="0.02" height="0.1" color="#c0c0c0"></a-cylinder>
                    <a-cylinder position="0 1.7 0" radius="0.02" height="0.1" color="#c0c0c0"></a-cylinder>
                    <a-cylinder position="0 1.6 0" radius="0.02" height="0.1" color="#c0c0c0"></a-cylinder>
                    <a-cylinder position="0 1.5 0" radius="0.02" height="0.1" color="#c0c0c0"></a-cylinder>
                </a-entity>
                
                <!-- ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - å¤§ããç›®ç«‹ã¤ -->
                <a-cylinder
                    position="0.6 1.0 0"
                    radius="0.06"
                    height="0.2"
                    color="#4ecdc4"
                    material="color: #4ecdc4; metalness: 0.5; roughness: 0.3; emissive: #00cccc; emissiveIntensity: 0.3;"
                    animation="property: position; to: 0.6 1.3 0; dir: alternate; loop: true; dur: 2000">
                </a-cylinder>
                
                <a-cylinder
                    position="-0.6 1.0 0"
                    radius="0.06"
                    height="0.2"
                    color="#ffe66d"
                    material="color: #ffe66d; metalness: 0.5; roughness: 0.3; emissive: #ffcc00; emissiveIntensity: 0.3;"
                    animation="property: position; to: -0.6 1.3 0; dir: alternate; loop: true; dur: 2500">
                </a-cylinder>
                
                <!-- ãƒ†ã‚¹ãƒˆç”¨ã®å·¨å¤§ãªçƒï¼ˆãƒ‡ãƒãƒƒã‚°ï¼‰ -->
                <a-sphere
                    id="test-sphere"
                    position="0 3.0 0"
                    radius="0.3"
                    color="#ff0000"
                    material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 0.8;"
                    animation="property: scale; to: 1.5 1.5 1.5; dir: alternate; loop: true; dur: 1000"
                    visible="true">
                </a-sphere>
            </a-entity>
        </a-marker>
        
        <!-- å¼·åŠ›ãªãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚° -->
        <a-light type="ambient" color="#ffffff" intensity="1.0"></a-light>
        <a-light type="directional" position="0 1 0" color="#ffffff" intensity="1.0"></a-light>
        <a-light type="point" position="0 2 1" color="#ffffff" intensity="0.8"></a-light>
        
        <!-- ã‚«ãƒ¡ãƒ© -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // DOMè¦ç´ 
        const markerStatus = document.getElementById('marker-status');
        const visibilityStatus = document.getElementById('visibility-status');
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é–¢æ•°
        function updateStatus(element, message, type = 'ok') {
            const statusClasses = { ok: 'status-ok', error: 'status-error', warning: 'status-warning' };
            element.innerHTML = element.innerHTML.split(':')[0] + ': ' + 
                `<span class="${statusClasses[type]}">${message}</span>`;
        }
        
        // ARã‚·ãƒ¼ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¯ AR Keyholder - Visibility Fix Version');
            
            const arScene = document.querySelector('a-scene');
            const marker = document.querySelector('#hiro-marker');
            const keyholderObject = document.querySelector('#keyholder-object');
            const testSphere = document.querySelector('#test-sphere');
            
            // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
            marker.addEventListener('markerFound', () => {
                console.log('ğŸ¯ Hiro marker detected - Making objects VISIBLE!');
                updateStatus(markerStatus, 'æ¤œå‡ºä¸­ - å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¤º!', 'ok');
                updateStatus(visibilityStatus, 'å¤§ããè¡¨ç¤ºä¸­!', 'ok');
                
                // å¼·åˆ¶çš„ã«å¯è¦–åŒ–
                keyholderObject.setAttribute('visible', true);
                testSphere.setAttribute('visible', true);
                
                // å¼·çƒˆãªå‡ºç¾ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                keyholderObject.setAttribute('animation__appear', {
                    property: 'scale',
                    from: '0 0 0',
                    to: '2 2 2',
                    dur: 1000,
                    easing: 'easeOutBounce'
                });
                
                // ãƒ†ã‚¹ãƒˆã‚¹ãƒ•ã‚£ã‚¢ã®ç‚¹æ»…
                testSphere.setAttribute('animation__blink', {
                    property: 'material.emissiveIntensity',
                    from: '0.8',
                    to: '1.5',
                    dir: 'alternate',
                    loop: true,
                    dur: 500
                });
            });
            
            marker.addEventListener('markerLost', () => {
                console.log('Hiro marker lost');
                updateStatus(markerStatus, 'æœªæ¤œå‡º - ãƒãƒ¼ã‚«ãƒ¼ã‚’æ¢ã—ã¦ã„ã¾ã™', 'warning');
                updateStatus(visibilityStatus, 'å¾…æ©Ÿä¸­', 'warning');
            });
            
            // AR.jsåˆæœŸåŒ–å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
            arScene.addEventListener('arjs-video-loaded', () => {
                console.log('ğŸš€ AR.js video loaded - Ready for BIG objects!');
                updateStatus(markerStatus, 'æ¤œå‡ºå¾…æ©Ÿä¸­', 'warning');
            });
        });
        
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.ARKeyholder = {
            version: '3.1.0-visibility-fix',
            forceShow: () => {
                const obj = document.querySelector('#keyholder-object');
                obj.setAttribute('visible', true);
                obj.setAttribute('scale', '3 3 3');
                console.log('Forced visibility ON');
            },
            toggleTestSphere: () => {
                const sphere = document.querySelector('#test-sphere');
                sphere.setAttribute('visible', !sphere.getAttribute('visible'));
            }
        };
    </script>
</body>
</html>